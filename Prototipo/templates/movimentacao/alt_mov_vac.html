{% extends 'base.html' %}

{% block content %}
  <h2>{% block title %}Alteração de movimentações - "{{ reg_mov['mov_id'] }}" {% endblock %}</h2>
  <p>
    <form method="POST">
      <div class="form-group">
        <label for="form_lote">Código do movimento</label>
        <input readonly type="number" name="form_id"
             placeholder="Código do movimento" class="form-control"
             value="{{ request.form['form_id'] or reg_mov['mov_id']}}"></input>
      </div>
      <div class="form-group">
        <label for="form_lote">Lote(*)</label>
        <input readonly required type="number" name="form_lote" class="form-control"
           value="{{ request.form['form_lote'] or reg_mov['mov_lote'] }}"></input>
      </div>
      <div class="form-group">
        <label for="form_vacina">Vacina(*)</label>
        <input readonly required type="number" name="form_vacina" class="form-control"
           value="{{ request.form['form_vacina'] or reg_mov['mov_vacina'] }}"></input>
      </div>
      <div class="form-group form_select">
        <label for="form_motivo">Motivo(*)</label>
        {% if (reg_mov['mov_motivo'] == "1") %} 
          <input readonly required type="text" name="form_motivo" class="form-control"
              value="Transferência"></input>
        {% endif %}
        {% if (reg_mov['mov_motivo'] == "2") %} 
          <input readonly required type="text" name="form_motivo" class="form-control"
              value="Uso e consumo"></input>
        {% endif %}
        {% if (reg_mov['mov_motivo'] == "3") %} 
          <input readonly required type="text" name="form_motivo" class="form-control"
              value="Perda"></input>
        {% endif %}
      </div>
      <div class="form-group">
        <label for="form_requisicao">Requisicao</label>
        <input readonly type="number" name="form_requisicao" class="form-control"
           value="{{ request.form['form_requisicao'] or reg_mov['mov_requisicao'] }}"></input>
      </div>
      <div class="form-group">
        <label for="form_ubs_orig">UBS de origem(*)</label>
        <input readonly required type="text" name="form_ubs_orig" class="form-control"
           value="{{ request.form['form_ubs_orig'] or reg_mov.mov_ubs.ubs_nome }}"></input>
      </div>
      <div class="form-group">
        <label for="form_ubs_dest">UBS de destino(*)</label>
        <input readonly required type="text" name="form_ubs_dest" class="form-control"
           value="{{ request.form['form_ubs_dest'] or reg_mov.mov_ubs_dest.ubs_nome }}"></input>

      </div>
        <!-- <div class="form-group">
        <label for="form_motivo">Motivo (*)</label>
        <input required type="Text" name="form_motivo"
           placeholder="Motivo" class="form-control"
           value="{{ request.form['form_motivo'] or reg_mov['mov_motivo'] }}"></input>
      </div> -->
      <div class="form-group">
         <label for="form_qtde">Quantidade (*)</label>
         <input required type="number" name="form_qtde"
            placeholder="Quantidade" class="form-control"
            value="{{ request.form['form_qtde'] or '%0.2f'|format(reg_mov['mov_qtde']|float)}}"></input>
      </div>
      <div class="form-group">
        <label for="form_dt_mov">Data da movimentação</label>
        <input readonly type="date" name="form_dt_mov"
             placeholder="Data da movimentação" class="form-control"
           value="{{ request.form['form_dt_mov'] or reg_mov['mov_dt_mov'].strftime('%Y-%m-%d') }}"></input>
      </div>
      <div class="form-group">
        <button type="submit" class="btn btn-primary">Alterar</button>
      </div>
    </form>  
    <form action="{{ url_for('del_mov', id=reg_mov['mov_id']) }}" method="POST">
        <input type="submit" value="Excluir"
              class="btn btn-danger"
              onclick="return confirm('Você tem certeza que quer apagar ?')">
    </form>
</p>
{% endblock %}
{% block scripts %} 
<script>
   function fnc_campos() {
      ws_select = document.getElementById('form_motivo');
      ws_requisicao = document.getElementById('form_requisicao');
      ws_ubs_orig = document.getElementById('form_ubs_orig');
      if (ws_select.value == 1) {
         ws_requisicao.readOnly = false;
         ws_ubs_orig.disabled = false;
      }
      else {
         ws_requisicao.readOnly = true;
         ws_ubs_orig.disabled = true;
         ws_ubs_orig.value = 999
      };
   }
</script>
{% endblock %}